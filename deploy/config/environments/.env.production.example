# ============================================================================
# SEL Backend Server - PRODUCTION Environment Configuration Template
# ============================================================================
# 
# ⚠️  CRITICAL SECURITY WARNINGS ⚠️
#
# 1. NEVER commit the actual .env.production file to version control
# 2. CHANGE ALL "CHANGE_ME" VALUES before deployment
# 3. Generate strong, unique secrets for each production environment
# 4. Rotate secrets regularly (quarterly minimum)
# 5. Use secure secret management (HashiCorp Vault, AWS Secrets Manager, etc.)
# 6. Restrict file permissions: chmod 600 .env.production
# 7. Never expose secrets in logs, error messages, or monitoring
#
# Copy this file to .env.production and configure with your production values
# ============================================================================

# Server Configuration
# Note: Use 0.0.0.0 to bind to all interfaces inside container
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
# ⚠️  CHANGE_ME: Set to your production domain
SERVER_BASE_URL=https://api.togather.events

# Database Configuration
# ⚠️  CRITICAL: Change database password and use strong credentials
# Format: postgresql://username:password@host:port/database?sslmode=require
DATABASE_URL=postgresql://togather:CHANGE_ME_secure_db_password_min_32_chars@prod-db:5432/togather_prod?sslmode=require
DATABASE_MAX_CONNECTIONS=50
DATABASE_MAX_IDLE_CONNECTIONS=10

# TLS/SSL Configuration
# ⚠️  Production MUST use TLS for all connections
DATABASE_SSL_MODE=require
# Optional: Path to CA certificate for database SSL verification
# DATABASE_SSL_ROOT_CERT=/etc/ssl/certs/ca-certificates.crt

# Bootstrap Admin User (FR-027)
# ⚠️  CRITICAL: Change these credentials immediately after first deployment
# After bootstrap, disable bootstrap mode or rotate credentials
ADMIN_USERNAME=admin
ADMIN_PASSWORD=CHANGE_ME_strong_admin_password_min_32_chars
ADMIN_EMAIL=admin@togather.events

# JWT Configuration
# ⚠️  CRITICAL: Generate a cryptographically secure random string (min 64 chars)
# Example generation: openssl rand -base64 64
JWT_SECRET=CHANGE_ME_production_secret_min_64_chars_use_openssl_rand_base64_64
JWT_EXPIRY_HOURS=24

# API Authentication
# ⚠️  CRITICAL: Generate secure API keys for admin operations
# Example generation: openssl rand -hex 32
ADMIN_API_KEY=CHANGE_ME_prod_api_key_use_openssl_rand_hex_32

# Rate Limiting (FR-020)
# Production: Stricter rate limits to prevent abuse
RATE_LIMIT_PUBLIC=30       # requests per minute (stricter than dev)
RATE_LIMIT_AGENT=150       # requests per minute (stricter than dev)
RATE_LIMIT_ADMIN=1000      # requests per minute (generous but not unlimited)

# CORS Configuration (Security: server-9hs)
# ⚠️  CRITICAL: Whitelist only your production domains (comma-separated)
# NEVER use "*" in production
# Example: CORS_ALLOWED_ORIGINS=https://togather.events,https://app.togather.events
CORS_ALLOWED_ORIGINS=https://togather.events

# Background Jobs (FR-029)
# Production: More aggressive retry policies
JOB_RETRY_DEDUPLICATION=3          # max attempts for dedup jobs
JOB_RETRY_RECONCILIATION=10        # max attempts for reconciliation
JOB_RETRY_ENRICHMENT=15            # max attempts for enrichment

# Environment
ENVIRONMENT=production

# Logging
# Production: Use 'warn' to reduce log volume, 'info' for detailed monitoring
LOG_LEVEL=warn
LOG_FORMAT=json  # Always use JSON in production for structured logging

# Request Logging
# Production: Log all requests for audit trail
ENABLE_REQUEST_LOGGING=true
REQUEST_LOG_BODY=false  # Set to true only for debugging (increases log volume)

# Federation
# ⚠️  Configure federation node name for this production instance
FEDERATION_NODE_NAME=prod-primary
FEDERATION_SYNC_ENABLED=true

# External Services
# ⚠️  Configure production endpoints and credentials
ARTSDATA_API_URL=https://api.artsdata.ca
WIKIDATA_SPARQL_ENDPOINT=https://query.wikidata.org/sparql

# Feature Flags
# Production: Enable features that are production-ready
ENABLE_VECTOR_SEARCH=false           # pgvector ready but not in MVP
ENABLE_AUTO_RECONCILIATION=false     # Enable when ready for production

# Timeout Configuration
# Production: Configure appropriate timeouts
HTTP_READ_TIMEOUT_SECONDS=30
HTTP_WRITE_TIMEOUT_SECONDS=30
HTTP_IDLE_TIMEOUT_SECONDS=120
DATABASE_QUERY_TIMEOUT_SECONDS=30

# Health Check Configuration
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_TIMEOUT_SECONDS=5

# Monitoring and Observability
# ⚠️  Configure production monitoring endpoints
ENABLE_METRICS=true
METRICS_PORT=9090
METRICS_PATH=/metrics

# Tracing (Optional: OpenTelemetry)
# ENABLE_TRACING=true
# OTLP_ENDPOINT=https://otel-collector.example.com:4317
# OTLP_HEADERS=x-api-key=CHANGE_ME_otel_api_key

# Sentry Error Tracking (Optional)
# SENTRY_DSN=https://CHANGE_ME@sentry.io/project-id
# SENTRY_ENVIRONMENT=production
# SENTRY_TRACES_SAMPLE_RATE=0.1

# Alerting (Optional: ntfy.sh webhook)
# ALERT_WEBHOOK_URL=https://ntfy.sh/your-topic
# ALERT_WEBHOOK_AUTH=CHANGE_ME_ntfy_auth_token

# Graceful Shutdown
GRACEFUL_SHUTDOWN_TIMEOUT_SECONDS=30

# ============================================================================
# DEPLOYMENT VALIDATION CHECKLIST
# ============================================================================
# Before deploying to production, verify:
# 
# [ ] All CHANGE_ME values have been replaced with secure values
# [ ] JWT_SECRET is at least 64 characters of random data
# [ ] Database password is strong (min 32 chars, high entropy)
# [ ] ADMIN_PASSWORD is strong and will be rotated after first login
# [ ] ADMIN_API_KEY is cryptographically secure (32+ hex chars)
# [ ] DATABASE_URL uses sslmode=require for encrypted connections
# [ ] CORS_ALLOWED_ORIGINS contains only your production domains (no wildcards)
# [ ] SERVER_BASE_URL matches your production domain with HTTPS
# [ ] LOG_LEVEL is set to 'warn' or 'info' (not 'debug')
# [ ] ENVIRONMENT is set to 'production'
# [ ] File permissions are restricted: chmod 600 .env.production
# [ ] Secrets are stored in secure secret management system
# [ ] Monitoring and alerting endpoints are configured
# [ ] Rate limits are appropriate for your traffic expectations
# [ ] Federation settings match your deployment topology
# 
# ============================================================================
# SECRET ROTATION SCHEDULE
# ============================================================================
# Establish a regular rotation schedule for all secrets:
# 
# - JWT_SECRET: Rotate quarterly (requires re-authentication of all users)
# - ADMIN_API_KEY: Rotate quarterly or after suspected compromise
# - Database credentials: Rotate quarterly using blue-green rotation
# - Admin password: Rotate monthly or after personnel changes
# - External service API keys: Follow provider recommendations
# 
# Document rotation procedures and maintain rotation audit log
# ============================================================================
