# ============================================================================
# SEL Backend Server - PRODUCTION Environment Configuration Template
# ============================================================================
# 
# ⚠️  CRITICAL SECURITY WARNINGS ⚠️
#
# 1. NEVER commit the actual .env.production file to version control
# 2. CHANGE ALL "CHANGE_ME" VALUES before deployment
# 3. Generate strong, unique secrets for each production environment
# 4. Rotate secrets regularly (quarterly minimum)
# 5. Use secure secret management (HashiCorp Vault, AWS Secrets Manager, etc.)
# 6. Restrict file permissions: chmod 600 .env.production
# 7. Never expose secrets in logs, error messages, or monitoring
#
# Copy this file to .env.production and configure with your production values
# ============================================================================

# Server Configuration
# Note: Use 0.0.0.0 to bind to all interfaces inside container
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
# ⚠️  CHANGE_ME: Set to your production domain
SERVER_BASE_URL=https://api.togather.events

# Database Configuration
# ⚠️  CRITICAL: Change database password and use strong credentials
# Format: postgresql://username:password@host:port/database?sslmode=require
DATABASE_URL=postgresql://togather:CHANGE_ME_secure_db_password_min_32_chars@prod-db:5432/togather_prod?sslmode=require
DATABASE_MAX_CONNECTIONS=50
DATABASE_MAX_IDLE_CONNECTIONS=10

# TLS/SSL Configuration
# ⚠️  Production MUST use TLS for all connections
DATABASE_SSL_MODE=require
# Optional: Path to CA certificate for database SSL verification
# DATABASE_SSL_ROOT_CERT=/etc/ssl/certs/ca-certificates.crt

# Bootstrap Admin User (FR-027)
# ⚠️  CRITICAL: Change these credentials immediately after first deployment
# After bootstrap, disable bootstrap mode or rotate credentials
ADMIN_USERNAME=admin
ADMIN_PASSWORD=CHANGE_ME_strong_admin_password_min_32_chars
ADMIN_EMAIL=admin@togather.events

# JWT Configuration
# ⚠️  CRITICAL: Generate a cryptographically secure random string (min 64 chars)
# Example generation: openssl rand -base64 64
JWT_SECRET=CHANGE_ME_production_secret_min_64_chars_use_openssl_rand_base64_64
JWT_EXPIRY_HOURS=24

# CSRF Protection (Security: server-fv1u)
# ⚠️  CRITICAL: Required for production admin HTML routes to prevent cross-site request forgery
# Generate with: openssl rand -base64 32
# Minimum 32 characters required
CSRF_KEY=CHANGE_ME_production_csrf_key_min_32_chars_use_openssl_rand_base64_32

# Rate Limiting (FR-020)
# Production: Stricter rate limits to prevent abuse
RATE_LIMIT_PUBLIC=30       # requests per minute (stricter than dev)
RATE_LIMIT_AGENT=150       # requests per minute (stricter than dev)
RATE_LIMIT_ADMIN=1000      # requests per minute (generous but not unlimited)

# Trusted Proxy Configuration (Security: server-chgh)
# ⚠️  CRITICAL: Configure the CIDR ranges of your load balancers/reverse proxies
# Only requests from these IPs will have X-Forwarded-For/X-Real-IP headers trusted
# This prevents IP spoofing attacks that bypass rate limiting
# Common cloud provider private IP ranges:
#   - AWS ALB/ELB internal: varies by VPC (e.g., 10.0.0.0/8)
#   - GCP Load Balancer: 130.211.0.0/22, 35.191.0.0/16
#   - Azure Load Balancer: varies by VNet (e.g., 10.0.0.0/8)
#   - Cloudflare: see https://www.cloudflare.com/ips/
# Example: TRUSTED_PROXY_CIDRS=10.0.0.0/8,172.16.0.0/12
TRUSTED_PROXY_CIDRS=10.0.0.0/8

# CORS Configuration (Security: server-9hs)
# ⚠️  CRITICAL: Whitelist only your production domains (comma-separated)
# NEVER use "*" in production
# Example: CORS_ALLOWED_ORIGINS=https://togather.events,https://app.togather.events
CORS_ALLOWED_ORIGINS=https://togather.events

# Background Jobs (FR-029)
# Production: More aggressive retry policies
JOB_RETRY_DEDUPLICATION=3          # max attempts for dedup jobs
JOB_RETRY_RECONCILIATION=10        # max attempts for reconciliation
JOB_RETRY_ENRICHMENT=15            # max attempts for enrichment

# Environment
ENVIRONMENT=production

# Logging
# Production: Use 'warn' to reduce log volume, 'info' for detailed monitoring
LOG_LEVEL=warn
LOG_FORMAT=json  # Always use JSON in production for structured logging

# Email Configuration
# ⚠️  Configure email for user invitations and notifications
# See docs/admin/email-setup.md for full configuration guide
# Provider options: "smtp" or "resend" (default: "smtp")
EMAIL_ENABLED=true
EMAIL_PROVIDER=resend
# ⚠️  CHANGE_ME: Set to your verified sending domain
EMAIL_FROM=noreply@togather.events
# ⚠️  CHANGE_ME: Resend API key from https://resend.com/api-keys
RESEND_API_KEY=CHANGE_ME_resend_api_key
# SMTP fallback (only needed if EMAIL_PROVIDER=smtp):
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-gmail-app-password
EMAIL_TEMPLATES_DIR=web/email/templates

# Request Logging
# Production: Log all requests for audit trail
ENABLE_REQUEST_LOGGING=true
REQUEST_LOG_BODY=false  # Set to true only for debugging (increases log volume)

# Federation
# ⚠️  Configure federation node name for this production instance
FEDERATION_NODE_NAME=prod-primary
FEDERATION_SYNC_ENABLED=true

# External Services
# ⚠️  Configure production endpoints and credentials
ARTSDATA_API_URL=https://api.artsdata.ca
WIKIDATA_SPARQL_ENDPOINT=https://query.wikidata.org/sparql

# Feature Flags
# Production: Enable features that are production-ready
ENABLE_VECTOR_SEARCH=false           # pgvector ready but not in MVP
ENABLE_AUTO_RECONCILIATION=false     # Enable when ready for production

# Timeout Configuration
# Production: Configure appropriate timeouts
HTTP_READ_TIMEOUT_SECONDS=30
HTTP_WRITE_TIMEOUT_SECONDS=30
HTTP_IDLE_TIMEOUT_SECONDS=120
DATABASE_QUERY_TIMEOUT_SECONDS=30

# Health Check Configuration
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_TIMEOUT_SECONDS=5

# Monitoring and Observability
# ⚠️  Configure production monitoring endpoints
ENABLE_METRICS=true
METRICS_PORT=9090
METRICS_PATH=/metrics

# Tracing (Optional: OpenTelemetry)
# ENABLE_TRACING=true
# OTLP_ENDPOINT=https://otel-collector.example.com:4317
# OTLP_HEADERS=x-api-key=CHANGE_ME_otel_api_key

# Sentry Error Tracking (Optional)
# SENTRY_DSN=https://CHANGE_ME@sentry.io/project-id
# SENTRY_ENVIRONMENT=production
# SENTRY_TRACES_SAMPLE_RATE=0.1

# Alerting (Optional: ntfy.sh webhook)
# ALERT_WEBHOOK_URL=https://ntfy.sh/your-topic
# ALERT_WEBHOOK_AUTH=CHANGE_ME_ntfy_auth_token

# Graceful Shutdown
GRACEFUL_SHUTDOWN_TIMEOUT_SECONDS=30

# ============================================================================
# DEPLOYMENT VALIDATION CHECKLIST
# ============================================================================
# Before deploying to production, verify:
# 
# [ ] All CHANGE_ME values have been replaced with secure values
# [ ] JWT_SECRET is at least 64 characters of random data
# [ ] CSRF_KEY is at least 32 characters of random data
# [ ] Database password is strong (min 32 chars, high entropy)
# [ ] ADMIN_PASSWORD is strong and will be rotated after first login
# [ ] DATABASE_URL uses sslmode=require for encrypted connections
# [ ] CORS_ALLOWED_ORIGINS contains only your production domains (no wildcards)
# [ ] SERVER_BASE_URL matches your production domain with HTTPS
# [ ] EMAIL_FROM domain is verified with your email provider (Resend/SMTP)
# [ ] RESEND_API_KEY is set (if using Resend provider)
# [ ] LOG_LEVEL is set to 'warn' or 'info' (not 'debug')
# [ ] ENVIRONMENT is set to 'production'
# [ ] File permissions are restricted: chmod 600 .env.production
# [ ] Secrets are stored in secure secret management system
# [ ] Monitoring and alerting endpoints are configured
# [ ] Rate limits are appropriate for your traffic expectations
# [ ] Federation settings match your deployment topology
# 
# ============================================================================
# SECRET ROTATION SCHEDULE
# ============================================================================
# Establish a regular rotation schedule for all secrets:
# 
# - JWT_SECRET: Rotate quarterly (requires re-authentication of all users)
# - CSRF_KEY: Rotate quarterly (requires re-authentication of admin sessions)
# - Database credentials: Rotate quarterly using blue-green rotation
# - Admin password: Rotate monthly or after personnel changes
# - External service API keys: Follow provider recommendations
# 
# Document rotation procedures and maintain rotation audit log
# ============================================================================
