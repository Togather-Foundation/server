# ============================================================================
# Togather Server - Docker Compose Environment Configuration
# ============================================================================
#
# This file contains environment variables for docker-compose.yml
# Copy this to .env and customize for your environment
#
# IMPORTANT: Never commit .env with real credentials to version control
# 
# ============================================================================

# Database Configuration
# ----------------------
# PostgreSQL database credentials
POSTGRES_DB=togather
POSTGRES_USER=togather
# ⚠️  REQUIRED: Change CHANGE_ME to a strong password
# This password MUST be set and must match the password in DATABASE_URL below.
# For production, use a strong password (minimum 32 characters recommended).
# Never use the default value 'togather_dev_password_change_in_production'.
POSTGRES_PASSWORD=togather_dev_password_change_in_production

# PostgreSQL performance tuning (adjust based on available memory)
POSTGRES_SHARED_BUFFERS=256MB
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB
POSTGRES_MAX_CONNECTIONS=100
POSTGRES_LOG_STATEMENT=none

# Application Configuration
# -------------------------
# Version metadata (auto-injected by deployment scripts)
VERSION=dev
GIT_COMMIT=unknown
BUILD_DATE=unknown

# Server settings
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
SERVER_BASE_URL=http://localhost:8080

# Database connection
# Note: Use 'togather-db' as hostname (Docker service name)
# SSL Mode Configuration:
# - sslmode=disable is acceptable for local Docker development
# - For staging/production deployments, MUST use sslmode=require or sslmode=verify-full
# - Production environments should enforce SSL/TLS for all database connections
DATABASE_URL=postgresql://togather:togather_dev_password_change_in_production@togather-db:5432/togather?sslmode=disable
DATABASE_MAX_CONNECTIONS=50
DATABASE_MAX_IDLE_CONNECTIONS=10
DATABASE_SSL_MODE=disable

# Authentication & Security
# CHANGE_ME: Generate secure values for production
# Example: openssl rand -base64 64
JWT_SECRET=dev_jwt_secret_change_in_production_min_64_chars
JWT_EXPIRY_HOURS=24
ADMIN_USERNAME=admin
ADMIN_PASSWORD=dev_admin_password_change_in_production
ADMIN_EMAIL=admin@togather.local

# Rate Limiting
RATE_LIMIT_PUBLIC=60
RATE_LIMIT_AGENT=300
RATE_LIMIT_ADMIN=1000

# CORS Configuration
# Development: Allow all origins
# Production: Set to specific domains (e.g., https://togather.events)
CORS_ALLOWED_ORIGINS=*

# Background Jobs
JOB_RETRY_DEDUPLICATION=3
JOB_RETRY_RECONCILIATION=10
JOB_RETRY_ENRICHMENT=15

# Environment & Logging
ENVIRONMENT=development
LOG_LEVEL=info
LOG_FORMAT=json
ENABLE_REQUEST_LOGGING=true
REQUEST_LOG_BODY=false

# Federation
FEDERATION_NODE_NAME=dev-node-1
FEDERATION_SYNC_ENABLED=false

# External Services
ARTSDATA_API_URL=https://api.artsdata.ca
WIKIDATA_SPARQL_ENDPOINT=https://query.wikidata.org/sparql

# Feature Flags
ENABLE_VECTOR_SEARCH=false
ENABLE_AUTO_RECONCILIATION=false

# Timeouts
HTTP_READ_TIMEOUT_SECONDS=30
HTTP_WRITE_TIMEOUT_SECONDS=30
HTTP_IDLE_TIMEOUT_SECONDS=120
DATABASE_QUERY_TIMEOUT_SECONDS=30

# Health Check
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_TIMEOUT_SECONDS=5

# Monitoring
ENABLE_METRICS=true
METRICS_PORT=9090
METRICS_PATH=/metrics

# Graceful Shutdown
GRACEFUL_SHUTDOWN_TIMEOUT_SECONDS=30

# ============================================================================
# Quick Start
# ============================================================================
# 1. Copy this file: cp .env.example .env
# 2. Update passwords and secrets (search for CHANGE_ME)
# 3. Start services: docker-compose up -d
# 4. Check logs: docker-compose logs -f
# 5. Access server: http://localhost:8080/health
# 6. Stop services: docker-compose down
#
# For production deployment, use the environment-specific templates in:
# deploy/config/environments/.env.production.example
# ============================================================================
