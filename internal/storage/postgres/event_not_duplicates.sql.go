// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: event_not_duplicates.sql

package postgres

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const insertNotDuplicate = `-- name: InsertNotDuplicate :exec

INSERT INTO event_not_duplicates (event_id_a, event_id_b, created_by)
VALUES (
  LEAST($1, $2),
  GREATEST($1, $2),
  $3
)
ON CONFLICT (event_id_a, event_id_b) DO NOTHING
`

type InsertNotDuplicateParams struct {
	EventIDA  interface{} `json:"event_id_a"`
	EventIDB  interface{} `json:"event_id_b"`
	CreatedBy pgtype.Text `json:"created_by"`
}

// SQLc queries for event_not_duplicates table.
// Tracks pairs of events that an admin has confirmed are NOT duplicates,
// preventing them from being re-flagged during near-duplicate detection.
// Record that two events are confirmed as NOT duplicates.
// Uses canonical ordering (smaller ULID first) to prevent storing both (A,B) and (B,A).
// ON CONFLICT DO NOTHING handles the case where the pair already exists.
func (q *Queries) InsertNotDuplicate(ctx context.Context, arg InsertNotDuplicateParams) error {
	_, err := q.db.Exec(ctx, insertNotDuplicate, arg.EventIDA, arg.EventIDB, arg.CreatedBy)
	return err
}

const isNotDuplicate = `-- name: IsNotDuplicate :one
SELECT EXISTS(
  SELECT 1 FROM event_not_duplicates
  WHERE event_id_a = LEAST($1, $2)
    AND event_id_b = GREATEST($1, $2)
) AS is_not_duplicate
`

type IsNotDuplicateParams struct {
	EventIDA string `json:"event_id_a"`
	EventIDB string `json:"event_id_b"`
}

// Check if a pair of events has been marked as not-duplicates.
// Uses canonical ordering to match regardless of argument order.
func (q *Queries) IsNotDuplicate(ctx context.Context, arg IsNotDuplicateParams) (bool, error) {
	row := q.db.QueryRow(ctx, isNotDuplicate, arg.EventIDA, arg.EventIDB)
	var is_not_duplicate bool
	err := row.Scan(&is_not_duplicate)
	return is_not_duplicate, err
}

const listNotDuplicatesForEvent = `-- name: ListNotDuplicatesForEvent :many
SELECT event_id_a, event_id_b, created_at, created_by
  FROM event_not_duplicates
 WHERE event_id_a = $1
    OR event_id_b = $1
 ORDER BY created_at DESC
`

// List all events that have been confirmed as NOT duplicates of a given event.
// Returns both sides of the pair (the given event could be event_id_a or event_id_b).
func (q *Queries) ListNotDuplicatesForEvent(ctx context.Context, eventID string) ([]EventNotDuplicate, error) {
	rows, err := q.db.Query(ctx, listNotDuplicatesForEvent, eventID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []EventNotDuplicate{}
	for rows.Next() {
		var i EventNotDuplicate
		if err := rows.Scan(
			&i.EventIDA,
			&i.EventIDB,
			&i.CreatedAt,
			&i.CreatedBy,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
