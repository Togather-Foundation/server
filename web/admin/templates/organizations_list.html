<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizations - SEL Admin</title>
    {{ template "_head_meta.html" . }}
    <link rel="stylesheet" href="/admin/static/css/tabler.min.css?v={{ assetVersion }}">
    <link rel="stylesheet" href="/admin/static/css/custom.css?v={{ assetVersion }}">
</head>
<body>
    {{ template "_header.html" . }}
    
    <!-- Page Content -->
    <div class="page">
        <div class="page-wrapper">
            <!-- Page header -->
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">Organizations</h2>
                            <div class="text-muted mt-1">Manage and merge duplicate organizations</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Page body -->
            <div class="page-body">
                <div class="container-xl">
                    <!-- Search and Filters -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-sm-6 col-lg">
                                    <div class="input-icon">
                                        <span class="input-icon-addon">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <circle cx="10" cy="10" r="7" />
                                                <line x1="21" y1="21" x2="15" y2="15" />
                                            </svg>
                                        </span>
                                        <input type="text" id="search-input" class="form-control" placeholder="Search organizations by name...">
                                    </div>
                                </div>
                                <div class="col-sm-6 col-lg-auto" style="min-width: 180px;">
                                    <input type="text" id="city-filter" class="form-control" placeholder="Filter by city...">
                                </div>
                                <div class="col-sm-6 col-lg-auto" style="min-width: 180px;">
                                    <select id="sort-select" class="form-select">
                                        <option value="created_at:asc">Date (oldest first)</option>
                                        <option value="created_at:desc">Date (newest first)</option>
                                        <option value="name:asc">Name (A-Z)</option>
                                        <option value="name:desc">Name (Z-A)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Loading state -->
                    <div id="loading-state" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="text-muted mt-3">Loading organizations...</p>
                    </div>
                    
                    <!-- Empty state -->
                    <div id="empty-state" class="empty text-center py-5" style="display: none;">
                        <div class="empty-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M3 21l18 0" />
                                <path d="M9 8l1 0" />
                                <path d="M9 12l1 0" />
                                <path d="M9 16l1 0" />
                                <path d="M14 8l1 0" />
                                <path d="M14 12l1 0" />
                                <path d="M14 16l1 0" />
                                <path d="M5 21v-16a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v16" />
                            </svg>
                        </div>
                        <p class="empty-title">No Organizations Found</p>
                        <p class="empty-subtitle text-muted">Try a different search term or clear filters</p>
                    </div>
                    
                    <!-- Organizations table -->
                    <div id="orgs-table-container" style="display: none;">
                        <div class="card">
                            <div class="table-responsive">
                                <table class="table table-vcenter">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>City</th>
                                            <th>Region</th>
                                            <th class="w-1">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orgs-tbody"></tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Load More -->
                        <div class="text-center mt-3" id="load-more-container" style="display: none;">
                            <button class="btn btn-outline-primary" data-action="load-more">Load More</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Merge Confirmation Modal -->
    <div class="modal fade" id="merge-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Organization Merge</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>This will merge the duplicate organization into the primary organization:</p>
                    <div class="row mb-3">
                        <div class="col-6">
                            <strong>Keep (Primary):</strong>
                            <div id="merge-primary-name" class="text-muted"></div>
                        </div>
                        <div class="col-6">
                            <strong>Remove (Duplicate):</strong>
                            <div id="merge-duplicate-name" class="text-muted"></div>
                        </div>
                    </div>
                    <div class="alert alert-warning mb-0">
                        <strong>What happens:</strong>
                        <ul class="mb-0">
                            <li>Events referencing the duplicate will be moved to the primary</li>
                            <li>Empty fields on the primary will be filled from the duplicate</li>
                            <li>The duplicate will be soft-deleted</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-merge-btn" data-action="confirm-merge">
                        Merge Organizations
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Organization Modal -->
    <div class="modal fade" id="edit-modal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Organization</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-ulid">
                    <div class="row mb-3">
                        <div class="col-12">
                            <label class="form-label">Name</label>
                            <input type="text" id="edit-name" class="form-control" maxlength="300">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea id="edit-description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="row mb-3">
                        <div class="col-12">
                            <label class="form-label">Street Address</label>
                            <input type="text" id="edit-street-address" class="form-control">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">City</label>
                            <input type="text" id="edit-city" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Region</label>
                            <input type="text" id="edit-region" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Postal Code</label>
                            <input type="text" id="edit-postal-code" class="form-control">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Country</label>
                            <input type="text" id="edit-country" class="form-control" maxlength="2" placeholder="CA">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Telephone</label>
                            <input type="tel" id="edit-telephone" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Email</label>
                            <input type="email" id="edit-email" class="form-control">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">URL</label>
                        <input type="url" id="edit-url" class="form-control" placeholder="https://">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-edit-btn" data-action="save-edit">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    {{ template "_footer.html" . }}
    <script src="/admin/static/js/organizations.js?v={{ assetVersion }}"></script>
</body>
</html>
